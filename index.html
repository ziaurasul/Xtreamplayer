<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XtreamPlayer Netflix Clone</title>
  <style>
    :root {
      --bg: #121212;
      --fg: #ffffff;
      --accent: #e50914;
    }
    body.light {
      --bg: #f9f9f9;
      --fg: #111;
    }
    body {
      margin: 0; font-family: Arial, sans-serif;
      background: var(--bg); color: var(--fg);
    }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    input, button { padding: 10px; width: 100%; margin: 5px 0; border-radius: 5px; border: none; }
    button { background: var(--accent); color: white; cursor: pointer; }
    .tabs button { width: 33%; background: #333; color: white; border: none; padding: 10px; }
    .tabs button.active { background: var(--accent); }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; margin-top: 10px; }
    .card { background: #222; padding: 5px; border-radius: 8px; overflow: hidden; cursor: pointer; }
    .card img { width: 100%; border-radius: 5px; }
    .card h4 { font-size: 14px; margin: 5px 0; }
    video { width: 100%; max-height: 500px; margin-top: 10px; background: black; }
    .topbar { display: flex; justify-content: space-between; align-items: center; }
    .toggle { cursor: pointer; font-size: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body class="dark">
  <div class="container">
    <div class="topbar">
      <h2>XtreamPlayer üçø</h2>
      <span class="toggle" onclick="toggleTheme()">üåì</span>
    </div>

    <!-- Login -->
    <div id="loginBox">
      <input type="text" id="server" placeholder="Server URL (http://...)" />
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">Login</button>
    </div>

    <!-- App Interface -->
    <div id="appBox" class="hidden">
      <div class="tabs">
        <button onclick="showTab('live')" class="active">Live TV</button>
        <button onclick="showTab('vod')">Movies</button>
        <button onclick="showTab('series')">Series</button>
      </div>

      <div id="live" class="grid"></div>
      <div id="vod" class="grid hidden"></div>
      <div id="series" class="grid hidden"></div>

      <video id="player" controls autoplay></video>
    </div>
  </div>

  <script>
    let baseUrl = '', user = '', pass = '';

    function login() {
      baseUrl = document.getElementById("server").value;
      user = document.getElementById("username").value;
      pass = document.getElementById("password").value;

      fetch(`${baseUrl}/player_api.php?username=${user}&password=${pass}`)
        .then(res => res.json())
        .then(data => {
          if (data.user_info && data.user_info.auth == 1) {
            document.getElementById('loginBox').classList.add('hidden');
            document.getElementById('appBox').classList.remove('hidden');
            loadAll();
          } else {
            alert("Login failed");
          }
        })
        .catch(() => alert("Login error. Check server and credentials."));
    }

    function loadAll() {
      loadContent('get_live_streams', 'live');
      loadContent('get_vod_streams', 'vod');
      loadContent('get_series', 'series');
    }

    function loadContent(action, tabId) {
      fetch(`${baseUrl}/player_api.php?username=${user}&password=${pass}&action=${action}`)
        .then(res => res.json())
        .then(data => {
          const grid = document.getElementById(tabId);
          grid.innerHTML = '';
          data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
              <img src="${item.stream_icon || item.cover || ''}" />
              <h4>${item.name}</h4>
            `;
            card.onclick = () => {
              let url;
              if (tabId === 'live') {
                url = `${baseUrl}/${user}/${pass}/${item.stream_id}.m3u8`;
              } else if (tabId === 'vod') {
                url = `${baseUrl}/movie/${user}/${pass}/${item.stream_id}.mp4`;
              } else if (tabId === 'series') {
                alert('Episode playback not implemented yet');
                return;
              }
              const player = document.getElementById('player');
              player.src = url;
              player.play();
              window.scrollTo(0, document.body.scrollHeight);
            };
            grid.appendChild(card);
          });
        });
    }

    function showTab(tab) {
      ['live', 'vod', 'series'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(tab).classList.remove('hidden');

      document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    function toggleTheme() {
      document.body.classList.toggle('light');
      document.body.classList.toggle('dark');
    }
  </script>
</body>
</html>
